FROM ubuntu:22.04

ENV OPTAPT=""
#ENV OPTAPT="-o Acquire::AllowInsecureRepositories=true -o Acquire::AllowDowngradeToInsecureRepositories=true"
RUN \
  apt-get ${OPTAPT} -y update && \
  apt-get ${OPTAPT} -y upgrade && \
  apt-get ${OPTAPT} -y install --no-install-recommends python3 python3-pip python-is-python3 && \
  apt-get ${OPTAPT} -y install --no-install-recommends libgomp1 && \
  rm -rf /var/lib/apt/lists/*
RUN ARC=$(uname -m) && \
  if test "${ARC}" = 'x86_64'; \
  then \
    pip3 install --no-cache-dir torch torchaudio torchvision --index-url https://download.pytorch.org/whl/cpu; \
  else \
    pip3 install --no-cache-dir torch torchaudio torchvision; \
  fi
RUN pip3 install --no-cache-dir -r https://raw.githubusercontent.com/comfyanonymous/ComfyUI/master/requirements.txt
